<!DOCTYPE html>
<meta charset="utf-8">
<title>Test Suite</title>
<script type="module">
  import UserAgent from './browser.js';

  async function tests() {
    const url = new URL(document.location);
    url.pathname = '/';
    const ua = new UserAgent({baseURL: url});

    // Hello World!
    {
      const res = await ua.get('/hello');
      console.assert(res.statusCode === 200, 'Hello status');
      console.assert(await res.text() === 'Hello World!', 'Hello body');
    }

    // Custom request
    {
      const res = await ua.request({url: '/hello'});
      console.assert(res.statusCode === 200, 'Custom status');
      console.assert(await res.text() === 'Hello World!', 'Custom body');

      const res2 = await ua.request({});
      console.assert(res2.statusCode === 404, 'Custom status two');
    }

    // HTML/XML
    {
      const res = await ua.get('/test.html');
      const html = await res.html();
      console.assert(html.at('div').text() === 'Test123', 'HTML text');

      const res2 = await ua.get('/test.xml');
      const xml = await res2.xml();
      console.assert(xml.find('script p').length === 1, 'XML find');
      console.assert(xml.at('script p').text() === 'Hello', 'XML text');

      const res3 = await ua.get('/test.xml');
      const html2 = await res3.html();
      console.assert(html2.at('script p') === null, 'XML is not HTML');
    }

    // Cookie
    {
      const res = await ua.get('/cookie');
      console.assert(res.statusCode === 200, 'Cookie status');
      console.assert(await res.text() === 'Cookie: not present', 'Cookie body');

      const res2 = await ua.get('/cookie');
      console.assert(res2.statusCode === 200, 'Cookie status two');
      console.assert(await res2.text() === 'Cookie: present', 'Cookie body two');

      const res3 = await ua.get('/cookie');
      console.assert(res3.statusCode === 200, 'Cookie status three');
      console.assert(await res3.text() === 'Cookie: present', 'Cookie body three');
    }

    document.write('<div id="tests">Tests finished!</div>');
  }

  tests();
</script>
